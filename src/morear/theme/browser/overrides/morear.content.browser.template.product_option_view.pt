<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    xmlns:v-on="http://www.vue.org/v-on"
    xmlns:v-bind="http://www.vue.org/v-bind"
    xmlns:v-model="http://www.vue.org/v-model"
    lang="en"
    metal:use-macro="context/main_template/macros/master"
    i18n:domain="plone">
<body>

<metal:content-core fill-slot="content-core">
<metal:content-core define-macro="content-core"
                    tal:define="toc context/table_of_contents|nothing;">

<?python
from plone import api
portal = api.portal.get()
prefix = '%s/++theme++moreartheme/' % portal.absolute_url()
?>


<div id="all" align="center">
<div id="in-bg">
<!-- content -->

<div id="wrapper">
    <metal:macro use-macro="context/@@morear_macro/macros/inner_header"/>
    <metal:macro use-macro="context/@@morear_macro/macros/title-tag"/>

    <metal:macro use-macro="context/@@object_macro/macros/product-headphone-option"/>



    <metal:macro use-macro="context/@@morear_macro/macros/back-top"/>
</div>


<metal:macro use-macro="context/@@morear_macro/macros/hide-all"/>

<metal:macro use-macro="context/@@morear_macro/macros/footer"/>


<script>
var vm = new Vue({
  el: '#content',
  data: {
    message: 'Hello Vue!',

    basePrice: ${context/basePrice},
    linePrice: ${python:context.lineLength[0].to_object.price},
    lineColorPrice: ${python:context.lineColor[0].to_object.price},
    shell3DPrice: ${python:context.shell3D[0].to_object.price},
    logoPrice: 300,
    logoColorPrice: ${python:context.logoColor[0].to_object.price},
    surfacePrice: ${python:context.surfaceColorR[0].to_object.price + context.surfaceColorL[0].to_object.price},
    laserTextR: '',
    laserTextL: '',
    laserPriceR: 0,
    laserPriceL: 0,
    extSer: '',
    outBoxText: '',

    // 客製化圖片參數
    upDownR: 50,
    upDownL: 50,
    leftRightR: 0,
    leftRightL: 0,
    zoomR: 100,
    zoomL: 100,
    rotateR: 0,
    rotateL: 0
  }
});

// 改變產品
$('#product-uid').change(function() {
    window.location.replace($(this).find(":selected").data('url'))
});

// 改變logo顏色
$('#logo-color img').click(function() {
    clickItem($(this));
    vm.logoColorPrice = Number($(this).data('price'));
});

// 輸入雷雕文字
$('#laser-text-r').change(function() {
    textR = $(this).val();
    if(textR){
        vm.laserPriceR = 100;
    }else{
        vm.laserPriceR = 0;
    }
});
$('#laser-text-l').change(function() {
    textL = $(this).val();
    if(textL){
        vm.laserPriceL = 100;
    }else{
        vm.laserPriceL = 0;
    }
});

// 改變耳機線長度
$('#lineLength').change(function() {
    vm.linePrice = Number($(this).find(":selected").data('price'))
});

// 改變耳機線顏色
$('#line-color img').click(function() {
    clickItem($(this));
    vm.lineColorPrice = Number($(this).data('price'));
});

// 改變3D列印耳殼
$('#shell-3d img').click(function() {
    clickItem($(this));
    vm.shell3DPrice = Number($(this).data('price'));
});

// 改變面板顏色
$('tr.surfaceColor td img').click(function() {
    clickItem($(this));
    vm.surfacePrice = 0;
    $('tr.surfaceColor td img.selected').each(function(){
        vm.surfacePrice += Number($(this).data('price'));  // Or this.innerHTML, this.innerText
    });
    
    // vm.surfacePrice = Number($(this).data('price') + );
});

// 選色
function clickItem(item) {
    $(item).attr('class', 'selected');
    $(item).siblings().removeAttr('class');
}

// 上傳檔案
function readURL(input, imgPosition) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $(imgPosition).attr('src', e.target.result).css({
                'display':'initial',
                'width': '100%',
                'height': 'initial',
                'position': 'absolute',
                'top': '50%',
                'left': '0%',
                'transform': 'rotate(0deg)'
            });
        }
        reader.readAsDataURL(input.files[0]);
    }
}
$("#cusImgR").change(function(){
    readURL(this, '#previewimgR');
    $('.option-right-side').fadeIn(1000);
});
$("#cusImgL").change(function(){
    readURL(this, '#previewimgL');
    $('.option-left-side').fadeIn(1000);
});

// Option bar(jRange)
$( document ).ready(function() {
    $('.option-bar').jRange({
        from: 0,
        to: 100,
        step: 1,
        showScale: false,
        format: '%s',
        width: 150,
        showLabels: false,
        isRange : false
    });

    $('.slider-container').css({'display':'inherit'})
});

// Option-bar value changed event
$(".option-bar").change(function(){
    elId = $(this).attr('id');
    vm.$data[elId] = $(this).attr('value');
    if( elId.endsWith('R') ){
        $( '#previewimgR' ).css({
            'top': vm.upDownR + '%',
            'left': vm.leftRightR + '%',
            'transform': 'rotate(' + vm.rotateR*3.6 + 'deg)',
            'width': vm.zoomR + '%'
        });
    } else{
        $( '#previewimgL' ).css({
            'top': vm.upDownL + '%',
            'left': vm.leftRightL + '%',
            'transform': 'rotate(' + vm.rotateL*3.6 + 'deg)',
            'width': vm.zoomL + '%'
        });
    }
});

</script>

</div>
</div>

</metal:content-core>
</metal:content-core>

</body>
</html>
